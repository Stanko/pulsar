var V=Object.defineProperty;var W=(s,t,e)=>t in s?V(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(W(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();const D="pulsar:autoplay",b=document.querySelector("input[name=autoplay]");b.checked=localStorage.getItem(D)==="true";b.addEventListener("change",()=>{localStorage.setItem(D,b.checked.toString())});const B=["classic","hex","triangular"],X=["both","scale","opacity"],z=120,T=["(Math.cos(x * t / 5) + Math.sin(y * t / 5)) / 2","(Math.cos(Math.sqrt(x * x + y * y) - t) + 1) / 2","(Math.cos(Math.sin(x * y) + t * 0.66) + 1) / 2","((Math.cos(t + x + Math.cos(t)) + Math.sin(t + y)) + 2) / 4","Math.sqrt(x*x + y*y) > (Math.cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1","Math.cos(x + t) > y * 0.3 + 0.5 ? (Math.cos(x + t) + 1) / 4 + 0.5 : 0","(t % 10) >= 5 ? (t % 5) / 5 : (5 - (t % 5)) / 5"],M={grid:"classic",animate:"scale",code:T[Math.floor(Math.random()*T.length)]},K=[{name:"grid",validate:s=>B.includes(s)?s:M.grid},{name:"animate",validate:s=>X.includes(s)?s:M.animate},{name:"code",validate:s=>{const t=J(s);return t.length<=z?t:M.code}}];function Y(s){return Object.entries(s).map(([t,e])=>(t==="code"&&(e=Q(e)),`${t}=${e}`)).join("&")}function Q(s){return encodeURIComponent(btoa(s))}function J(s){try{return atob(decodeURIComponent(s))}catch{return""}}class tt{constructor(t){a(this,"params",{...M});a(this,"handler");a(this,"$inputs");this.handler=t,this.$inputs=[...document.querySelectorAll("input[name=grid], input[name=animate], textarea[name=code]")],this.$inputs.forEach(e=>{e.addEventListener("input",()=>{this.params[e.name]=e.value,this.updateURL(),this.handler(this.params,e.name)})}),this.updateParamsFromURL()}updateInputs(){this.$inputs.forEach(t=>{t.type==="radio"||t.type==="checkbox"?t.checked=t.value===this.params[t.name]:t.value=this.params[t.name],t.dispatchEvent(new Event("change"))})}updateParamsFromURL(){const t=new URLSearchParams(window.location.search);K.forEach(e=>{t.get(e.name)&&Object.keys(this.params).includes(e.name)&&(this.params[e.name]=e.validate(t.get(e.name)||""))}),this.updateInputs()}updateURL(){const t=Y(this.params),e=`${window.location.origin}${window.location.pathname}?${t}`;window.history.replaceState(null,"",e)}}const k=new Worker(new URL("/pulsar/assets/worker-9ce69331.js",self.location));let G;k.addEventListener("message",s=>{G(s.data)});async function et(s,t,e){return new Promise(i=>{G=i,k.postMessage({grid:s.map(({x:r,y:o})=>({x:r,y:o})),t,userCode:e})})}const st=["fetch","import","export","eval","Function","window","self","top","location","document","alert","prompt","confirm","XMLHttpRequest","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","addEventListener","removeEventListener","dispatchEvent","localStorage","sessionStorage","indexedDB","Geolocation","await","async","WebSocket","Worker","postMessage","importScripts","URL"],rt={equals:/(\b=\b)/g,quotes:new RegExp(`((&#39;.*?&#39;)|(&#34;.*?&#34;)|(".*?(?<!\\\\)")|('.*?(?<!\\\\)')|\`)`,"g"),comments:/((\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*))/g,logic:/(%=|%|\-|\+|\*|&amp;{1,2}|\|{1,2}|&lt;=|&gt;=|&lt;|&gt;|!={1,2}|={2,3})/g,fn:new RegExp("(?<=^|\\s*)(abs|acos|asin|atan|atan2|ceil|cos|floor|log|max|min|pow|random|round|sin|sqrt|tan|noise|async|await|window|fetch|console|alert|Math|Object|Array|String|class(?!\\s*\\=)|function)(?=\\b)","g"),number:/(\d+(\.\d+)?(e\d+)?)/g,declaration:new RegExp("(?<=^|\\s*)(var|let|const)","g"),parenthesis:/(\(|\))/g,squared:/(\[|\])/g,curly:/(\{|\})/g};class U{constructor(){a(this,"$textarea");a(this,"$pre");a(this,"$error");a(this,"value","");a(this,"error","");a(this,"validate",()=>{const t=this.$textarea.value.trim();this.highlightCode();for(const e of st)if(t.includes(e)){const i=`Let's play nice, no usage of "${e}" allowed.`;this.error=i;return}this.error="",this.value=t});this.$pre=document.querySelector(".editor__pre"),this.$error=document.querySelector(".editor__error"),this.$textarea=document.querySelector(".editor__textarea"),this.$textarea.addEventListener("input",this.validate),this.$textarea.addEventListener("change",this.validate),this.validate(),this.$textarea.addEventListener("keydown",t=>{t.key=="Enter"&&t.preventDefault()})}highlightCode(){let t=this.$textarea.value;for(const[e,i]of Object.entries(rt))t=t.replace(i,`<i class="${e}">$1</i>`);this.$pre.innerHTML=t}showError(t){this.error=t,this.$error.innerHTML=t}hideError(){this.error="",this.$error.innerHTML=""}}new U;function F(s){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${s.width} ${s.height}`),t.setAttribute("width",`${s.width}`),t.setAttribute("height",`${s.height}`),t.style.opacity="0",t}function N(s,t={}){const e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("points",s.map(({x:i,y:r})=>`${i.toFixed(2)},${r.toFixed(2)}`).join(" "));for(const i in t)e.setAttribute(i,t[i]);return e}function it(s,t,e={}){const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",s.x.toFixed(2)),i.setAttribute("cy",s.y.toFixed(2)),i.setAttribute("r",t.toFixed(2));for(const r in e)i.setAttribute(r,e[r]);return i}const I=["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#5856d7","#af52de","#ff2c55"];function O(s,t=1){const e=Math.sqrt(Math.pow(s.x*t,2)+Math.pow(s.y*t,2));return I[Math.floor(e)]||I[I.length-1]}const ot=1.1,E=100,_=E*.85;function at(s,t){const e=[],i=.5*ot,r=2*i/Math.sqrt(3),o=i*2,n=r*1.5,A=Math.PI/3,S=Math.PI/6;for(let d=-t;d<=t;d+=1){const l=d*n,h=d%2!==0,p=h?i:0,R=h?1:0;for(let m=-s-R;m<=s;m+=1){const f=m*o+p,u=[0,1,2,3,4,5].map(P=>{const g=P*A+S;return{x:E*.5+r*_*Math.cos(g),y:E*.5+r*_*Math.sin(g)}}),c=F({width:E,height:E}),L=N(u,{fill:O({x:f,y:l})});c.classList.add("hex"),c.appendChild(L),c.style.left=`${(f*100).toFixed(2)}%`,c.style.top=`${(-l*100).toFixed(2)}%`,e.push({x:f,y:l,$element:c})}}return e}const q=.8,w=100;function nt(s,t){const e=[],r=1*Math.sqrt(3)/2,o=r/3*2*w,n=1/2,A=r,S=Math.PI/6,d=S*4;for(let l=-t;l<=t;l+=1){const h=l*A,p=l%2!==0,R=p?n:0,m=p?2:1,f=p?0:1;for(let u=-s-m;u<=s+f;u+=1){const c=u*n+R,L=u%2!==0,P=L?Math.PI:0,g=L?r/3:0,j=[0,1,2].map(Z=>{const C=Z*d+S+P;return{x:.5*w+o*q*Math.cos(C),y:.5*w+o*q*Math.sin(C)}}),y=F({width:w,height:w}),H=N(j,{fill:O({x:c,y:h+g},1/q)});y.classList.add("triangle"),y.appendChild(H),y.style.left=`${(c*100).toFixed(2)}%`,y.style.top=`${((h+g)*-100).toFixed(2)}%`,e.push({x:c,y:h,$element:y})}}return e}const ct=.88,lt=.5*ct,x=100;function dt(s){const t=[];for(let e=-s;e<=s;e+=1)for(let i=-s;i<=s;i+=1){const r=F({width:x,height:x}),o=it({x:x*.5,y:x*.5},lt*x,{fill:O({x:e,y:i})});r.appendChild(o),r.classList.add("circle"),r.style.left=`${(e*100).toFixed(2)}%`,r.style.top=`${(-i*100).toFixed(2)}%`,t.push({x:e,y:i,$element:r})}return t}const ht={classic:()=>dt(6),hex:()=>at(5,6),triangular:()=>nt(8,5)};class ut{constructor(t="classic"){a(this,"$element",document.querySelector(".pixel-wrapper"));a(this,"pixels",[]);this.update(t)}update(t="classic"){this.pixels=ht[t](),this.$element.replaceChildren(...this.pixels.map(e=>e.$element)),this.$element.dataset.variant=t}}const $=document.querySelector(".share");let v=0;$.addEventListener("click",async()=>{try{navigator.share?await navigator.share({title:document.title,url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),clearTimeout(v),$.classList.add("share--success"),v=setTimeout(()=>{$.classList.remove("share--success")},3e3))}catch(s){if(s.name==="AbortError")return;clearTimeout(v),$.classList.add("share--error"),v=setTimeout(()=>{$.classList.remove("share--error")},3e3)}});const pt=document.querySelector(".pulsar"),mt=document.querySelector(".play-pause"),ft=[...document.querySelectorAll(".toggle-ui")];class gt{constructor(){a(this,"isPlaying",!1);a(this,"raf",0);a(this,"time",0);a(this,"lastRestart",Date.now());a(this,"timeSinceLastRestart",0);a(this,"fps",0);a(this,"fpsStartTime",Date.now());a(this,"grid");a(this,"editor");a(this,"controls");a(this,"animate",async()=>{this.timeSinceLastRestart=this.time+(Date.now()-this.lastRestart)/200,await this.draw()&&this.isPlaying&&(this.raf=requestAnimationFrame(this.animate))});this.editor=new U,this.controls=new tt((t,e)=>{e==="grid"?this.grid.update(t.grid):e==="code"&&this.isPlaying&&this.play(),this.isPlaying||this.draw()}),this.grid=new ut(this.controls.params.grid),this.isPlaying=b.checked,this.isPlaying?this.play():this.draw(),mt.addEventListener("click",()=>{this.isPlaying?this.pause():this.play()}),ft.forEach(t=>{t.addEventListener("click",()=>{document.body.classList.toggle("ui-hidden")})}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.pause()})}updateRootClass(){const t=["pulsar"];this.isPlaying?t.push("is-playing"):t.push("is-paused"),this.editor.error&&t.push("has-error"),pt.setAttribute("class",t.join(" "))}play(){this.isPlaying=!0,this.lastRestart=Date.now(),this.animate(),this.fpsStartTime=Date.now(),this.fps=0,this.updateRootClass()}pauseOnError(){cancelAnimationFrame(this.raf),this.time=this.timeSinceLastRestart,this.fpsStartTime=Date.now(),this.fps=0,this.updateRootClass()}pause(){this.isPlaying=!1,this.time=this.timeSinceLastRestart,cancelAnimationFrame(this.raf),this.updateRootClass()}async draw(){if(this.editor.error)return this.editor.showError(this.editor.error),this.pauseOnError(),!1;const t=await et(this.grid.pixels,this.timeSinceLastRestart,this.controls.params.code);return this.fps++,Date.now()-this.fpsStartTime>1e3&&(console.log("fps",this.fps),this.fpsStartTime=Date.now(),this.fps=0),t.error?(this.editor.showError(t.error),this.pauseOnError(),!1):(this.editor.hideError(),t.data.forEach((e,i)=>{const r=this.grid.pixels[i];if(!r)return;const o=100;let n=(e===0?1e3:(1-1/e)*o).toFixed(2);this.controls.params.animate==="scale"?(r.$element.style.transform=`perspective(${o}px) translateZ(${n}px)`,r.$element.style.opacity=""):this.controls.params.animate==="opacity"?(r.$element.style.opacity=e.toFixed(2),r.$element.style.transform=""):(r.$element.style.transform=`perspective(${o}px) translateZ(${n}px)`,r.$element.style.opacity=e.toFixed(2))}),this.updateRootClass(),!0)}}new gt;
