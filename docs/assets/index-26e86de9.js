var tt=Object.defineProperty;var et=(s,t,e)=>t in s?tt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(et(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();const b=document.querySelector(".share");let P=0;b.addEventListener("click",async()=>{try{navigator.share?await navigator.share({title:"Check my Pulsar animation",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),clearTimeout(P),b.classList.add("share--success"),P=setTimeout(()=>{b.classList.remove("share--success")},3e3))}catch(s){if(s.name==="AbortError")return;clearTimeout(P),b.classList.add("share--error"),P=setTimeout(()=>{b.classList.remove("share--error")},3e3)}});let S=localStorage.getItem("pulsar:debug")==="true";window.debug=()=>{localStorage.setItem("pulsar:debug",(!S).toString()),window.location.reload()};S&&document.body.classList.add("debug");function c(...s){S&&console.log(...s)}const st=["grid","animate","code"];function at(s){return encodeURIComponent(btoa(s))}function it(s){try{return atob(decodeURIComponent(s))}catch{return""}}function T(s){const t=new URLSearchParams(window.location.search);Object.entries(s).forEach(([a,n])=>{a==="code"?t.set(a,at(n)):t.set(a,n)});for(const a of t.keys())st.includes(a)||t.delete(a);const e=t.toString(),i=`${window.location.origin}${window.location.pathname}?${e}`;c("Updated URL:",JSON.stringify(s)),window.history.replaceState(null,"",i)}const A={code:"sin(t) * 0.5 + 0.5",grid:"classic",animate:"scale"};class ot{constructor(){o(this,"code",A.code);o(this,"grid",A.grid);o(this,"animate",A.animate);o(this,"error","");o(this,"handlers",{code:[],grid:[],animate:[]})}onChange(t,e){this.handlers[t].push(e)}updateRadio(t,e){this[t]!==e&&(t==="animate"?(c("Animate changed:",e),this.animate=e):t==="grid"&&(c("Grid changed:",e),this.grid=e),this.handlers[t].forEach(i=>i(e))),T({[t]:e})}updateCode(t){c("Code changed:",t),this.code=t,this.handlers.code.forEach(e=>e(t)),T({code:t})}updateAll(t){this.code=t.code,this.animate=t.animate,this.grid=t.grid,this.handlers.code.forEach(e=>e(this.code)),this.handlers.animate.forEach(e=>e(this.animate)),this.handlers.grid.forEach(e=>e(this.grid)),T(t)}}const r=new ot,N=[{code:"(cos(x * t / 5) + sin(y * t / 5)) / 2"},{code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"hex"},{code:"(cos(sin(x * y) + t * 0.66) + 1) / 2"},{code:"((cos(t + x + cos(t)) + sin(t + y)) + 2) / 4"},{code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1"},{code:"cos(x + t) > y * 0.3 + 0.5 ? (cos(x + t) + 1) / 4 + 0.5 : 0"},{code:"cos(t * 0.5) * 0.5 + 0.5",animate:"opacity"},{code:"sin(0.5 * x + y * t * 0.8) * sin(t / 4)",grid:"triangular"},{code:"sin(x * cos(t * 0.5)) + cos(y * sin(t * 0.5))",grid:"hex"},{code:" sin(t) * sin(x) + cos(t) * cos(y)",grid:"triangular",animate:"opacity"},{code:"abs(abs(x) - abs(y)) < t % 7 ? 1 : 0",grid:"hex"},{code:"sin(3 * atan2(y,x) + t)",grid:"hex"},{code:"1 - (((x + 3) * (x + 4) + y + t * 0.3 * (1 + x * x % 5) * 3) % 36) / 12",animate:"opacity"},{code:"1 / abs((x + y) + (t * 4) % 70 - 35)"}];function X(){return{grid:"classic",animate:"scale",...N[Math.floor(Math.random()*N.length)]}}const U=X(),nt=document.querySelector(".random-example");nt.addEventListener("click",()=>{const s=X();r.updateAll({grid:s.grid||"classic",animate:s.animate||"scale",code:s.code})});const Y=new Worker(new URL("/pulsar/assets/worker-b40f7b8b.js",self.location));let D={};Y.addEventListener("message",s=>{D[s.data.id](s.data),delete D[s.data.id]});async function B(s,t,e){return new Promise(i=>{const a=Math.random().toString(16)+Date.now().toString(16);D[a]=i,Y.postMessage({id:a,grid:s,t,userCode:e})})}const C=["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#5856d7","#af52de","#ff2c55"];function _(s,t=1){const e=Math.sqrt(Math.pow(s.x*t,2)+Math.pow(s.y*t,2));return C[Math.floor(e)]||C[C.length-1]}const x=400,R=x*.075,rt=1.1,ct=R*.85;function dt(s,t){const e=[],i=.5*rt,a=2*i/Math.sqrt(3),n=i*2,l=a*1.5;for(let p=-t;p<=t;p+=1){const m=p*l,g=p%2!==0,y=g?i:0,L=g?1:0;for(let w=-s-L;w<=s;w+=1){const E=w*n+y,f=_({x:E,y:m});e.push({x:E,y:m,color:f,r:a*ct})}}return e}const q=1.33,V=.8;function lt(s,t){const e=[],a=1*Math.sqrt(3)/2,n=a/3*2*R,l=1/2,p=a;for(let m=-t;m<=t;m+=1){const g=m*p,y=m%2!==0,L=y?l:0,w=y?2:1,E=y?0:1;for(let f=-s-w;f<=s+E;f+=1){const k=f*l+L,G=f%2!==0,Q=G?Math.PI:0,F=G?a/3:0,Z=_({x:k,y:g-F},1/V);e.push({x:k*q,y:(g-F)*q,r:n*V*q,color:Z,angleOffset:Q})}}return e}const ht=.88,ut=.5*ht;function mt(s){const t=[];for(let e=-s;e<=s;e+=1)for(let i=-s;i<=s;i+=1){const a=_({x:i,y:e});t.push({x:i,y:e,r:ut*R,color:a})}return t}const pt={classic:()=>mt(6),hex:()=>dt(5,6),triangular:()=>lt(8,5)};class ft{constructor(t="classic"){o(this,"type","classic");o(this,"points",[]);this.type=t,this.update(t)}update(t="classic"){this.type=t,this.points=pt[t]()}}const I=document.querySelector(".canvas"),M=window.devicePixelRatio,d=I.getContext("2d");I.width=x*M;I.height=x*M;d.scale(M,M);const{PI:gt}=Math,H=Math.PI/6,J=H*2,yt=J*2,O=[0,1,2,3,4,5].map(s=>H+s*J),$=[0,1,2].map(s=>gt+H+s*yt);function wt(s,t){const{x:e,y:i}=s;d.moveTo(e+t*Math.cos(O[0]),i+t*Math.sin(O[0])),O.forEach(a=>{d.lineTo(e+t*Math.cos(a),i+t*Math.sin(a))})}function xt(s,t,e){const{x:i,y:a}=s;d.moveTo(i+t*Math.cos($[0]+e),a+t*Math.sin($[0]+e)),$.forEach(n=>{d.lineTo(i+t*Math.cos(n+e),a+t*Math.sin(n+e))})}function Lt(s,t){const{x:e,y:i}=s;d.arc(e,i,t,0,2*Math.PI)}const Et={classic:Lt,hex:wt,triangular:xt};function vt(s,t){d.clearRect(0,0,x,x);const e=r.animate==="scale"||r.animate==="both",i=r.animate==="opacity"||r.animate==="both";s.forEach((a,n)=>{const{color:l,x:p,y:m,r:g,angleOffset:y}=a,L=t[n],w=e?L:1,E=i?L:1,f=Et[r.grid];d.globalAlpha=E,d.fillStyle=l,d.beginPath(),f({x:p*R+x*.5,y:x*.5-m*R},g*w,y||0),d.fill()})}const St=document.querySelector(".pulsar"),bt=document.querySelector(".play-pause"),Rt=[...document.querySelectorAll(".toggle-ui")];Rt.forEach(s=>{s.addEventListener("click",()=>{document.body.classList.toggle("ui-hidden")})});const Pt=document.querySelector("input[name=autoplay]"),Mt=document.querySelector(".fps"),Tt=document.querySelector(".fps__value");class At{constructor(){o(this,"isPlaying",!1);o(this,"wasPlaying",!1);o(this,"raf",0);o(this,"time",0);o(this,"lastRestart",Date.now());o(this,"timeSinceLastRestart",0);o(this,"fps",0);o(this,"fpsHistory",[]);o(this,"fpsStartTime",Date.now());o(this,"grid");o(this,"draw",async()=>{if(cancelAnimationFrame(this.raf),r.error!==""){this.pauseOnError();return}const t=await B(this.grid.points,this.timeSinceLastRestart,r.code);if(S&&(this.fps++,Date.now()-this.fpsStartTime>1e3&&(this.fpsHistory.push(this.fps),this.fpsHistory.length>60&&this.fpsHistory.shift(),Mt.innerHTML=this.fpsHistory.map(e=>`<div class="fps__bar" style="height: ${e/2}%"></div>`).join(`
`),Tt.innerHTML=this.fps.toString(),this.fpsStartTime=Date.now(),this.fps=0)),t.error){this.pauseOnError();return}vt(this.grid.points,t.data),this.updateRootClass(),this.isPlaying&&(this.raf=requestAnimationFrame(this.animate))});o(this,"animate",()=>{this.timeSinceLastRestart=this.time+(Date.now()-this.lastRestart)/200,this.draw()});o(this,"playOrDraw",()=>{this.isPlaying?(c("Play or draw - start/resume animation"),this.animate()):(c("Play or draw - draw a single frame"),this.draw())});this.grid=new ft(r.grid),this.isPlaying=Pt.checked,this.playOrDraw(),r.onChange("grid",t=>{this.grid.update(t),this.playOrDraw()}),r.onChange("animate",this.playOrDraw),r.onChange("code",()=>{this.playOrDraw()}),bt.addEventListener("click",()=>{this.isPlaying?this.pause():this.play()}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(c("Tab went inactive"),this.wasPlaying=this.isPlaying,this.pause()):document.visibilityState==="visible"&&this.wasPlaying&&(c("Tab is active again - resuming"),this.play())})}updateRootClass(){const t=["pulsar"];this.isPlaying?t.push("is-playing"):t.push("is-paused"),St.setAttribute("class",t.join(" "))}play(){if(this.isPlaying){c("Play, already playing");return}c("Play"),this.isPlaying=!0,this.lastRestart=Date.now(),this.animate(),S&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pauseOnError(){cancelAnimationFrame(this.raf),this.time=this.timeSinceLastRestart,c("Pause on error"),S&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pause(){c("Pause"),this.isPlaying=!1,this.time=this.timeSinceLastRestart,cancelAnimationFrame(this.raf),this.updateRootClass()}}const Ct=["fetch","import","export","eval","Function","window","self","top","location","document","alert","prompt","confirm","XMLHttpRequest","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","addEventListener","removeEventListener","dispatchEvent","localStorage","sessionStorage","indexedDB","Geolocation","await","async","WebSocket","Worker","postMessage","importScripts","URL","console","debugger"],qt=300,Ot={equals:/(\b=\b)/g,quotes:new RegExp(`((&#39;.*?&#39;)|(&#34;.*?&#34;)|(".*?(?<!\\\\)")|('.*?(?<!\\\\)')|\`)`,"g"),comments:/((\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*))/g,logic:/(%=|%|\-|\+|\*|&amp;{1,2}|\|{1,2}|&lt;=|&gt;=|&lt;|&gt;|!={1,2}|={2,3})/g,fn:new RegExp("(?<=^|\\s*)(abs|acos|asin|atan|atan2|ceil|cos|floor|log|max|min|pow|random|round|sin|sqrt|tan|noise|async|await|window|fetch|console|alert|Math|Object|Array|String|class(?!\\s*\\=)|function)(?=\\b)","g"),number:/(\d+(\.\d+)?(e\d+)?)/g,declaration:new RegExp("(?<=^|\\s*)(var|let|const)","g"),parenthesis:/(\(|\))/g,squared:/(\[|\])/g,curly:/(\{|\})/g},h=document.querySelector(".editor__textarea"),j=document.querySelector(".editor__error"),$t=document.querySelector(".editor__pre"),Dt=[{x:0,y:0}];class Ut{constructor(){o(this,"timeout",0);o(this,"validate",async()=>{clearTimeout(this.timeout);const t=h.value;if(this.highlightCode(),t===""){this.showError("Type some code to get started.");return}for(const i of Ct)if(t.includes(i)){this.showError(`Let's play nice, no usage of "${i}" allowed.`);return}const e=await B(Dt,0,t);if(e.error){this.showError(e.error);return}c(r.error),this.hideError(),r.updateCode(t)});h.addEventListener("input",this.validate),h.addEventListener("change",this.validate),this.updateFromURL(),h.addEventListener("keydown",t=>{t.key=="Enter"&&t.preventDefault()}),r.onChange("code",t=>this.updateValue(t))}updateValue(t){h.value!==t&&(h.value=t,this.highlightCode(),c("Editor, code updated"),r.error&&this.validate())}update(t){h.value!==t&&(h.value=t,c("Editor, code updated and validated")),this.validate()}updateFromURL(){const e=new URLSearchParams(window.location.search).get("code")||"",i=it(e)||U.code;i.length>qt?this.update("Code in the URL is too long."):this.update(i)}highlightCode(){let t=h.value;for(const[e,i]of Object.entries(Ot))t=t.replace(i,`<i class="${e}">$1</i>`);$t.innerHTML=t}showError(t){c(`Error: %c${t}`,"color: red","code:",h.value),r.error=t,j.innerHTML=t}hideError(){c("Clear error"),r.error="",j.innerHTML=""}}class z{constructor(t,e,i){o(this,"$inputs");o(this,"name");o(this,"options");o(this,"initialValue");this.name=t,this.options=e,this.initialValue=i,this.$inputs=[...document.querySelectorAll(`input[name=${t}]`)],this.$inputs.forEach(a=>{a.checked=a.value===i,a.addEventListener("change",()=>{r.updateRadio(this.name,a.value)})}),r.onChange(t,a=>{this.$inputs.forEach(n=>{n.checked=n.value===a})}),this.updateFromURL()}updateFromURL(){let e=new URLSearchParams(window.location.search).get(this.name)||this.initialValue;this.options.includes(e)||(e=this.options[0]),r.updateRadio(this.name,e)}update(t){r.updateRadio(this.name,t)}}const W=document.querySelector(".tutorial"),K=document.querySelector(".intro-text");let v=null;const u=[{text:"Pulsar allows you to create animations using code.",code:"sin(t) * 0.5 + 0.5",grid:"classic",animate:"scale"},{text:"Write code that returns a value between 0 and 1. Try changing the code below.",code:"0.5 ",grid:"classic",animate:"scale"},{text:'The code is evaluated for each "pixel" individually.',code:"random()",grid:"classic",animate:"scale"},{text:'Parameter "t" is time in fifth of a second.',code:"cos(t) * 0.5 + 0.5",grid:"classic",animate:"scale"},{text:'You can speed up or slow down the animation by multiplying the "t". To make it loop use the "%" operator.',code:"(t * 0.1) % 1",grid:"classic",animate:"scale"},{text:'Parameters "x" and "y" are coordinates and they span roughly from -6 to 6.',code:"abs(x / 12) + abs(y / 12)",grid:"classic",animate:"scale"},{text:'Parameter "i" is the index of the pixel in the grid.',code:"i % 2"},{text:'You can use any of the mathematical functions available in JavaScript like "cos" or "sqrt".',code:"cos(x) + sin(y)",grid:"classic",animate:"scale"},{text:"Simplex noise is also available.",code:"noise(x + t, y + t)",grid:"classic",animate:"scale"},{text:"You can switch between different grid types and animation properties.",code:"cos(x + t) * 0.5 + 0.5",grid:"hex",animate:"both"},{text:"Here are a few examples to get you started. Radial wave:",code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"classic",animate:"scale"},{text:"Liner cosine wave:",code:"cos(x * 0.8 + t) > y * 0.25 ? 1 : 0",grid:"classic",animate:"scale"},{text:'"Floral" pattern:',code:"(cos(sin(x * y) + t * 0.66) + 1) / 2",grid:"classic",animate:"scale"},{text:"Experiment combining different functions and parameters to create funky animations. Have fun!",code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1",grid:"classic",animate:"scale"},{text:K.innerText,code:""}],_t={[u.length-2]:"Finish",[u.length-1]:"Restart"};class It{constructor(t){u[u.length-1].code=r.code,u[u.length-1].grid=r.grid,u[u.length-1].animate=r.animate,W.addEventListener("click",()=>{v===null?v=0:v=(v+1)%u.length,W.innerHTML=_t[v]||"Next";const e=u[v];K.innerHTML=e.text,r.updateAll({grid:e.grid||"classic",animate:e.animate||"scale",code:e.code}),t.isPlaying||t.play()})}}new z("grid",["classic","hex","triangular"],U.grid||"");new z("animate",["scale","opacity","both"],U.animate||"");new Ut;const Ht=new At;new It(Ht);
