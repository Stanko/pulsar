var B=Object.defineProperty;var X=(s,t,e)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var r=(s,t,e)=>(X(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const _="pulsar:autoplay",T=document.querySelector("input[name=autoplay]");localStorage.getItem(_)&&(T.checked=localStorage.getItem(_)==="true");T.addEventListener("change",()=>{localStorage.setItem(_,T.checked.toString())});const K=["classic","hex","triangular"],J=["both","scale","opacity"],Q=120,G=[{code:"(cos(x * t / 5) + sin(y * t / 5)) / 2"},{code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"hex"},{code:"(cos(sin(x * y) + t * 0.66) + 1) / 2"},{code:"((cos(t + x + cos(t)) + sin(t + y)) + 2) / 4"},{code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1"},{code:"cos(x + t) > y * 0.3 + 0.5 ? (cos(x + t) + 1) / 4 + 0.5 : 0"},{code:"cos(t * 0.5) * 0.5 + 0.5",animate:"opacity"},{code:"sin(0.5 * x + y * t * 0.8) * sin(t / 4)",grid:"triangular"},{code:"sin(x * cos(t * 0.5)) + cos(y * sin(t * 0.5))",grid:"hex"},{code:" sin(t) * sin(x) + cos(t) * cos(y)",grid:"triangular",animate:"opacity"},{code:"abs(abs(x) - abs(y)) < t % 7 ? 1 : 0",grid:"hex"}],tt=G[Math.floor(Math.random()*G.length)],P={grid:"classic",animate:"scale",...tt},et=[{name:"grid",validate:s=>K.includes(s)?s:P.grid},{name:"animate",validate:s=>J.includes(s)?s:P.animate},{name:"code",validate:s=>{const t=at(s);return t.length<=Q?t:P.code}}];function st(s){return Object.entries(s).map(([t,e])=>(t==="code"&&(e=it(e)),`${t}=${e}`)).join("&")}function it(s){return encodeURIComponent(btoa(s))}function at(s){try{return atob(decodeURIComponent(s))}catch{return""}}class ot{constructor(t){r(this,"params",{...P});r(this,"handler");r(this,"$inputs");this.handler=t,this.$inputs=[...document.querySelectorAll("input[name=grid], input[name=animate], textarea[name=code]")],this.$inputs.forEach(e=>{e.addEventListener("input",()=>{this.params[e.name]=e.value,this.updateURL(),this.handler(this.params,e.name)})}),this.updateParamsFromURL(),this.updateURL()}updateInputs(){this.$inputs.forEach(t=>{t.type==="radio"||t.type==="checkbox"?t.checked=t.value===this.params[t.name]:t.value=this.params[t.name],t.dispatchEvent(new Event("change"))})}updateParamsFromURL(){const t=new URLSearchParams(window.location.search);et.forEach(e=>{t.get(e.name)&&Object.keys(this.params).includes(e.name)&&(this.params[e.name]=e.validate(t.get(e.name)||""))}),this.updateInputs()}updateURL(){const t=st(this.params),e=`${window.location.origin}${window.location.pathname}?${t}`;window.history.replaceState(null,"",e)}}const N=new Worker(new URL("/pulsar/assets/worker-9ce69331.js",self.location));let j;N.addEventListener("message",s=>{j(s.data)});async function rt(s,t,e){return new Promise(a=>{j=a,N.postMessage({grid:s.map(({x:i,y:o})=>({x:i,y:o})),t,userCode:e})})}const nt=["fetch","import","export","eval","Function","window","self","top","location","document","alert","prompt","confirm","XMLHttpRequest","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","addEventListener","removeEventListener","dispatchEvent","localStorage","sessionStorage","indexedDB","Geolocation","await","async","WebSocket","Worker","postMessage","importScripts","URL","console","debugger"],ct={equals:/(\b=\b)/g,quotes:new RegExp(`((&#39;.*?&#39;)|(&#34;.*?&#34;)|(".*?(?<!\\\\)")|('.*?(?<!\\\\)')|\`)`,"g"),comments:/((\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*))/g,logic:/(%=|%|\-|\+|\*|&amp;{1,2}|\|{1,2}|&lt;=|&gt;=|&lt;|&gt;|!={1,2}|={2,3})/g,fn:new RegExp("(?<=^|\\s*)(abs|acos|asin|atan|atan2|ceil|cos|floor|log|max|min|pow|random|round|sin|sqrt|tan|noise|async|await|window|fetch|console|alert|Math|Object|Array|String|class(?!\\s*\\=)|function)(?=\\b)","g"),number:/(\d+(\.\d+)?(e\d+)?)/g,declaration:new RegExp("(?<=^|\\s*)(var|let|const)","g"),parenthesis:/(\(|\))/g,squared:/(\[|\])/g,curly:/(\{|\})/g};class lt{constructor(){r(this,"$textarea");r(this,"$pre");r(this,"$error");r(this,"value","");r(this,"error","");r(this,"validate",()=>{const t=this.$textarea.value.trim();this.highlightCode();for(const e of nt)if(t.includes(e)){const a=`Let's play nice, no usage of "${e}" allowed.`;this.error=a;return}this.error="",this.value=t});this.$pre=document.querySelector(".editor__pre"),this.$error=document.querySelector(".editor__error"),this.$textarea=document.querySelector(".editor__textarea"),this.$textarea.addEventListener("input",this.validate),this.$textarea.addEventListener("change",this.validate),this.validate(),this.$textarea.addEventListener("keydown",t=>{t.key=="Enter"&&t.preventDefault()})}update(t){this.$textarea.value=t,this.validate(),this.$textarea.dispatchEvent(new Event("input"))}highlightCode(){let t=this.$textarea.value;for(const[e,a]of Object.entries(ct))t=t.replace(a,`<i class="${e}">$1</i>`);this.$pre.innerHTML=t}showError(t){this.error=t,this.$error.innerHTML=t}hideError(){this.error="",this.$error.innerHTML=""}}function k(s){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${s.width} ${s.height}`),t.setAttribute("width",`${s.width}`),t.setAttribute("height",`${s.height}`),t.style.opacity="0",t}function W(s,t={}){const e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("points",s.map(({x:a,y:i})=>`${a.toFixed(2)},${i.toFixed(2)}`).join(" "));for(const a in t)e.setAttribute(a,t[a]);return e}function dt(s,t,e={}){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",s.x.toFixed(2)),a.setAttribute("cy",s.y.toFixed(2)),a.setAttribute("r",t.toFixed(2));for(const i in e)a.setAttribute(i,e[i]);return a}const C=["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#5856d7","#af52de","#ff2c55"];function D(s,t=1){const e=Math.sqrt(Math.pow(s.x*t,2)+Math.pow(s.y*t,2));return C[Math.floor(e)]||C[C.length-1]}const ht=1.1,L=100,H=L*.85;function ut(s,t){const e=[],a=.5*ht,i=2*a/Math.sqrt(3),o=a*2,n=i*1.5,q=Math.PI/3,$=Math.PI/6;for(let u=-t;u<=t;u+=1){const d=u*n,m=u%2!==0,g=m?a:0,I=m?1:0;for(let f=-s-I;f<=s;f+=1){const y=f*o+g,p=[0,1,2,3,4,5].map(F=>{const x=F*q+$;return{x:L*.5+i*H*Math.cos(x),y:L*.5+i*H*Math.sin(x)}}),l=k({width:L,height:L}),b=W(p,{fill:D({x:y,y:d})});l.classList.add("hex"),l.appendChild(b),l.style.left=`${(y*100).toFixed(2)}%`,l.style.top=`${(-d*100).toFixed(2)}%`,e.push({x:y,y:d,$element:l})}}return e}const O=.8,v=100;function mt(s,t){const e=[],i=1*Math.sqrt(3)/2,o=i/3*2*v,n=1/2,q=i,$=Math.PI/6,u=$*4;for(let d=-t;d<=t;d+=1){const m=d*q,g=d%2!==0,I=g?n:0,f=g?2:1,y=g?0:1;for(let p=-s-f;p<=s+y;p+=1){const l=p*n+I,b=p%2!==0,F=b?Math.PI:0,x=b?i/3:0,Z=[0,1,2].map(z=>{const U=z*u+$+F;return{x:.5*v+o*O*Math.cos(U),y:.5*v+o*O*Math.sin(U)}}),w=k({width:v,height:v}),V=W(Z,{fill:D({x:l,y:m+x},1/O)});w.classList.add("triangle"),w.appendChild(V),w.style.left=`${(l*100).toFixed(2)}%`,w.style.top=`${((m+x)*-100).toFixed(2)}%`,e.push({x:l,y:m,$element:w})}}return e}const pt=.88,gt=.5*pt,S=100;function ft(s){const t=[];for(let e=-s;e<=s;e+=1)for(let a=-s;a<=s;a+=1){const i=k({width:S,height:S}),o=dt({x:S*.5,y:S*.5},gt*S,{fill:D({x:e,y:a})});i.appendChild(o),i.classList.add("circle"),i.style.left=`${(e*100).toFixed(2)}%`,i.style.top=`${(-a*100).toFixed(2)}%`,t.push({x:e,y:a,$element:i})}return t}const yt={classic:()=>ft(6),hex:()=>ut(5,6),triangular:()=>mt(8,5)};class xt{constructor(t="classic"){r(this,"$element",document.querySelector(".pixel-wrapper"));r(this,"pixels",[]);r(this,"type","classic");this.type=t,this.update(t)}update(t="classic"){this.type=t,this.pixels=yt[t](),this.$element.replaceChildren(...this.pixels.map(e=>e.$element)),this.$element.dataset.variant=t}}const R=document.querySelector(".tutorial"),Y=document.querySelector(".intro-text");let h=null;const c=[{text:"Pulsar allows you to create animations using code.",code:"sin(t) * 0.5 + 0.5",grid:"classic",animate:"scale"},{text:"Write code that returns a value between 0 and 1 (try changing it).",code:"0.5 ",grid:"classic",animate:"scale"},{text:'The code is evaluated for each "pixel" individually.',code:"random()",grid:"classic",animate:"scale"},{text:'Parameter "t" is time in fifth of a second.',code:"cos(t) * 0.5 + 0.5",grid:"classic",animate:"scale"},{text:'You can slow down the animation by multiplying the "t" and make it loop using "%" operator.',code:"(t * 0.1) % 1",grid:"classic",animate:"scale"},{text:'Parameters "x" and "y" are coordinates and they span roughly from -6 to 6.',code:"abs(x / 12) + abs(y / 12)",grid:"classic",animate:"scale"},{text:'You can use any of the mathematical functions available in JavaScript like "cos" or "sqrt".',code:"cos(x) + sin(y)",grid:"classic",animate:"scale"},{text:"Simplex noise is also available.",code:"noise(x + t, y + t)",grid:"classic",animate:"scale"},{text:"You can switch between different grid types and animation properties.",code:"cos(x + t) * 0.5 + 0.5",grid:"hex",animate:"both"},{text:"Here are a few examples to get you started. Radial wave:",code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"classic",animate:"scale"},{text:"Liner cosine wave:",code:"cos(x * 0.8 + t) > y * 0.25 ? 1 : 0",grid:"classic",animate:"scale"},{text:'"Floral" pattern:',code:"(cos(sin(x * y) + t * 0.66) + 1) / 2",grid:"classic",animate:"scale"},{text:"Experiment combining different functions and parameters to create funky animations. Have fun!",code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1",grid:"classic",animate:"scale"},{text:Y.innerText,code:""}];class wt{constructor(t){c[c.length-1].code=t.controls.params.code,c[c.length-1].grid=t.controls.params.grid,c[c.length-1].animate=t.controls.params.animate,R.addEventListener("click",()=>{h===null?h=0:h=(h+1)%c.length,h===c.length-2?R.innerHTML="Finish":h===c.length-1?R.innerHTML="Restart":R.innerHTML="Next";const e=c[h];Y.innerHTML=e.text,t.editor.update(e.code),(e.grid||e.animate)&&(e.grid&&t.grid.type!==e.grid&&(t.controls.params.grid=e.grid,t.grid.update(e.grid)),e.animate&&(t.controls.params.animate=e.animate),t.controls.updateURL(),t.controls.updateParamsFromURL(),t.controls.updateInputs()),t.isPlaying||t.play()})}}const E=document.querySelector(".share");let A=0;E.addEventListener("click",async()=>{try{navigator.share?await navigator.share({title:"Check my Pulsar animation",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),clearTimeout(A),E.classList.add("share--success"),A=setTimeout(()=>{E.classList.remove("share--success")},3e3))}catch(s){if(s.name==="AbortError")return;clearTimeout(A),E.classList.add("share--error"),A=setTimeout(()=>{E.classList.remove("share--error")},3e3)}});let M=localStorage.getItem("pulsar:debug")==="true";window.debug=()=>{localStorage.setItem("pulsar:debug",M.toString()),window.location.reload()};const vt=document.querySelector(".pulsar"),St=document.querySelector(".play-pause"),Et=[...document.querySelectorAll(".toggle-ui")];class Lt{constructor(){r(this,"isPlaying",!1);r(this,"raf",0);r(this,"time",0);r(this,"lastRestart",Date.now());r(this,"timeSinceLastRestart",0);r(this,"fps",0);r(this,"fpsStartTime",Date.now());r(this,"grid");r(this,"editor");r(this,"controls");r(this,"animate",async()=>{this.timeSinceLastRestart=this.time+(Date.now()-this.lastRestart)/200,await this.draw()&&this.isPlaying&&(this.raf=requestAnimationFrame(this.animate))});this.editor=new lt,this.controls=new ot((t,e)=>{e==="grid"?this.grid.update(t.grid):e==="code"&&this.isPlaying&&this.play(),this.isPlaying||this.draw()}),this.grid=new xt(this.controls.params.grid),new wt(this),this.isPlaying=T.checked,this.isPlaying?this.play():this.draw(),St.addEventListener("click",()=>{this.isPlaying?this.pause():this.play()}),Et.forEach(t=>{t.addEventListener("click",()=>{document.body.classList.toggle("ui-hidden")})}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.pause()})}updateRootClass(){const t=["pulsar"];this.isPlaying?t.push("is-playing"):t.push("is-paused"),this.editor.error&&t.push("has-error"),vt.setAttribute("class",t.join(" "))}play(){this.isPlaying=!0,this.lastRestart=Date.now(),this.animate(),M&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pauseOnError(){cancelAnimationFrame(this.raf),this.time=this.timeSinceLastRestart,M&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pause(){this.isPlaying=!1,this.time=this.timeSinceLastRestart,cancelAnimationFrame(this.raf),this.updateRootClass()}async draw(){if(this.editor.error)return this.editor.showError(this.editor.error),this.pauseOnError(),!1;const t=await rt(this.grid.pixels,this.timeSinceLastRestart,this.controls.params.code);return M&&(this.fps++,Date.now()-this.fpsStartTime>1e3&&(console.log("fps",this.fps),this.fpsStartTime=Date.now(),this.fps=0)),t.error?(this.editor.showError(t.error),this.pauseOnError(),!1):(this.editor.hideError(),t.data.forEach((e,a)=>{const i=this.grid.pixels[a];if(!i)return;const o=100;let n=(e===0?1e3:(1-1/e)*o).toFixed(2);this.controls.params.animate==="scale"?(i.$element.style.transform=`perspective(${o}px) translateZ(${n}px)`,i.$element.style.opacity=""):this.controls.params.animate==="opacity"?(i.$element.style.opacity=e.toFixed(2),i.$element.style.transform=""):(i.$element.style.transform=`perspective(${o}px) translateZ(${n}px)`,i.$element.style.opacity=e.toFixed(2))}),this.updateRootClass(),!0)}}new Lt;if(window.location.hostname==="muffinman.io"){const s=document.createElement("script");s.setAttribute("data-goatcounter","https://muffinman_io.goatcounter.com/count"),s.setAttribute("async",""),s.setAttribute("src","//gc.zgo.at/count.js"),document.body.appendChild(s)}
