var et=Object.defineProperty;var st=(i,t,e)=>t in i?et(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var o=(i,t,e)=>(st(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const B=new Worker(new URL("/pulsar/assets/worker-b40f7b8b.js",self.location));let U={};B.addEventListener("message",i=>{U[i.data.id](i.data),delete U[i.data.id]});async function Y(i,t,e){return new Promise(a=>{const s=Math.random().toString(16)+Date.now().toString(16);U[s]=a,B.postMessage({id:s,grid:i,t,userCode:e})})}function _(i){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${i.width} ${i.height}`),t.setAttribute("width",`${i.width}`),t.setAttribute("height",`${i.height}`),t.style.opacity="0",t}function X(i,t={}){const e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("points",i.map(({x:a,y:s})=>`${a.toFixed(2)},${s.toFixed(2)}`).join(" "));for(const a in t)e.setAttribute(a,t[a]);return e}function it(i,t,e={}){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx",i.x.toFixed(2)),a.setAttribute("cy",i.y.toFixed(2)),a.setAttribute("r",t.toFixed(2));for(const s in e)a.setAttribute(s,e[s]);return a}const O=["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#5856d7","#af52de","#ff2c55"];function k(i,t=1){const e=Math.sqrt(Math.pow(i.x*t,2)+Math.pow(i.y*t,2));return O[Math.floor(e)]||O[O.length-1]}const at=1.1,v=100,V=v*.85;function ot(i,t){const e=[],a=.5*at,s=2*a/Math.sqrt(3),n=a*2,c=s*1.5,C=Math.PI/3,P=Math.PI/6;for(let m=-t;m<=t;m+=1){const h=m*c,g=m%2!==0,y=g?a:0,q=g?1:0;for(let x=-i-q;x<=i;x+=1){const w=x*n+y,f=[0,1,2,3,4,5].map(F=>{const L=F*C+P;return{x:v*.5+s*V*Math.cos(L),y:v*.5+s*V*Math.sin(L)}}),d=_({width:v,height:v}),A=X(f,{fill:k({x:w,y:h})});d.classList.add("hex"),d.appendChild(A),d.style.left=`${(w*100).toFixed(2)}%`,d.style.top=`${(-h*100).toFixed(2)}%`,e.push({x:w,y:h,$element:d})}}return e}const D=.8,E=100;function nt(i,t){const e=[],s=1*Math.sqrt(3)/2,n=s/3*2*E,c=1/2,C=s,P=Math.PI/6,m=P*4;for(let h=-t;h<=t;h+=1){const g=h*C,y=h%2!==0,q=y?c:0,x=y?2:1,w=y?0:1;for(let f=-i-x;f<=i+w;f+=1){const d=f*c+q,A=f%2!==0,F=A?Math.PI:0,L=A?s/3:0,K=[0,1,2].map(tt=>{const H=tt*m+P+F;return{x:.5*E+n*D*Math.cos(H),y:.5*E+n*D*Math.sin(H)}}),S=_({width:E,height:E}),Q=X(K,{fill:k({x:d,y:g+L},1/D)});S.classList.add("triangle"),S.appendChild(Q),S.style.left=`${(d*100).toFixed(2)}%`,S.style.top=`${((g+L)*-100).toFixed(2)}%`,e.push({x:d,y:g,$element:S})}}return e}const rt=.88,ct=.5*rt,b=100;function lt(i){const t=[];for(let e=-i;e<=i;e+=1)for(let a=-i;a<=i;a+=1){const s=_({width:b,height:b}),n=it({x:b*.5,y:b*.5},ct*b,{fill:k({x:a,y:e})});s.appendChild(n),s.classList.add("circle"),s.style.left=`${(a*100).toFixed(2)}%`,s.style.top=`${(-e*100).toFixed(2)}%`,t.push({x:a,y:e,$element:s})}return t}const dt={classic:()=>lt(6),hex:()=>ot(5,6),triangular:()=>nt(8,5)},N=document.querySelector(".pixel-wrapper");class ht{constructor(t="classic"){o(this,"type","classic");o(this,"points",[]);o(this,"$points",[]);this.type=t,this.update(t)}update(t="classic"){this.type=t;const e=dt[t]();this.points=e.map(a=>({x:a.x,y:a.y})),this.$points=e.map(a=>a.$element),N.replaceChildren(...this.$points),N.dataset.variant=t}}let R=localStorage.getItem("pulsar:debug")==="true";window.debug=()=>{localStorage.setItem("pulsar:debug",(!R).toString()),window.location.reload()};R&&document.body.classList.add("debug");const ut=["grid","animate","code"];function pt(i){return encodeURIComponent(btoa(i))}function mt(i){try{return atob(decodeURIComponent(i))}catch{return""}}function j(i){const t=new URLSearchParams(window.location.search);Object.entries(i).forEach(([s,n])=>{s==="code"?t.set(s,pt(n)):t.set(s,n)});for(const s of t.keys())ut.includes(s)||t.delete(s);const e=t.toString(),a=`${window.location.origin}${window.location.pathname}?${e}`;window.history.replaceState(null,"",a)}const I={code:"sin(t) * 0.5 + 0.5",grid:"classic",animate:"scale"};class gt{constructor(){o(this,"code",I.code);o(this,"grid",I.grid);o(this,"animate",I.animate);o(this,"error","");o(this,"handlers",{code:[],grid:[],animate:[]})}onChange(t,e){this.handlers[t].push(e)}updateRadio(t,e){this[t]!==e&&(t==="animate"?this.animate=e:t==="grid"&&(this.grid=e),this.handlers[t].forEach(s=>s(e)));const a=document.querySelector(`input[name=${t}][value=${e}]`);a.checked=!0,j({[t]:e})}updateCode(t){t!==this.code&&(this.code=t,this.handlers.code.forEach(e=>e(t)),j({code:t}))}}const r=new gt,ft=document.querySelector(".pulsar"),yt=document.querySelector(".play-pause"),xt=[...document.querySelectorAll(".toggle-ui")];xt.forEach(i=>{i.addEventListener("click",()=>{document.body.classList.toggle("ui-hidden")})});const wt=document.querySelector("input[name=autoplay]");class Lt{constructor(){o(this,"isPlaying",!1);o(this,"wasPlaying",!1);o(this,"raf",0);o(this,"time",0);o(this,"lastRestart",Date.now());o(this,"timeSinceLastRestart",0);o(this,"fps",0);o(this,"fpsStartTime",Date.now());o(this,"grid");o(this,"draw",async()=>{if(cancelAnimationFrame(this.raf),r.error!==""){this.pauseOnError();return}const t=await Y(this.grid.points,this.timeSinceLastRestart,r.code);if(R&&(this.fps++,Date.now()-this.fpsStartTime>1e3&&(console.log("fps",this.fps),this.fpsStartTime=Date.now(),this.fps=0)),t.error){this.pauseOnError();return}t.data.forEach((e,a)=>{const s=this.grid.$points[a];if(!s)return;const n=100;let c=(e===0?1e3:(1-1/e)*n).toFixed(2);r.animate==="scale"?(s.style.transform=`perspective(${n}px) translateZ(${c}px)`,s.style.opacity=""):r.animate==="opacity"?(s.style.opacity=e.toFixed(2),s.style.transform=""):(s.style.transform=`perspective(${n}px) translateZ(${c}px)`,s.style.opacity=e.toFixed(2))}),this.updateRootClass(),this.isPlaying&&(this.raf=requestAnimationFrame(this.animate))});o(this,"animate",()=>{this.timeSinceLastRestart=this.time+(Date.now()-this.lastRestart)/200,this.draw()});o(this,"playOrDraw",()=>{this.isPlaying?this.animate():this.draw()});this.grid=new ht(r.grid),this.isPlaying=wt.checked,this.playOrDraw(),r.onChange("grid",t=>{this.grid.update(t),this.playOrDraw()}),r.onChange("animate",this.playOrDraw),r.onChange("code",()=>{this.playOrDraw()}),yt.addEventListener("click",()=>{this.isPlaying?this.pause():this.play()}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(this.wasPlaying=this.isPlaying,this.pause()):document.visibilityState==="visible"&&this.wasPlaying&&this.play()})}updateRootClass(){const t=["pulsar"];this.isPlaying?t.push("is-playing"):t.push("is-paused"),ft.setAttribute("class",t.join(" "))}play(){this.isPlaying||(this.isPlaying=!0,this.lastRestart=Date.now(),this.animate(),R&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass())}pauseOnError(){cancelAnimationFrame(this.raf),this.time=this.timeSinceLastRestart,R&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pause(){this.isPlaying=!1,this.time=this.timeSinceLastRestart,cancelAnimationFrame(this.raf),this.updateRootClass()}}const W=[{code:"(cos(x * t / 5) + sin(y * t / 5)) / 2"},{code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"hex"},{code:"(cos(sin(x * y) + t * 0.66) + 1) / 2"},{code:"((cos(t + x + cos(t)) + sin(t + y)) + 2) / 4"},{code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1"},{code:"cos(x + t) > y * 0.3 + 0.5 ? (cos(x + t) + 1) / 4 + 0.5 : 0"},{code:"cos(t * 0.5) * 0.5 + 0.5",animate:"opacity"},{code:"sin(0.5 * x + y * t * 0.8) * sin(t / 4)",grid:"triangular"},{code:"sin(x * cos(t * 0.5)) + cos(y * sin(t * 0.5))",grid:"hex"},{code:" sin(t) * sin(x) + cos(t) * cos(y)",grid:"triangular",animate:"opacity"},{code:"abs(abs(x) - abs(y)) < t % 7 ? 1 : 0",grid:"hex"},{code:"sin(3 * atan2(y,x) + t)",grid:"hex"},{code:"1 - (((x + 3) * (x + 4) + y + t * 0.3 * (1 + x * x % 5) * 3) % 36) / 12",animate:"opacity"}],G=W[Math.floor(Math.random()*W.length)],St=["fetch","import","export","eval","Function","window","self","top","location","document","alert","prompt","confirm","XMLHttpRequest","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","addEventListener","removeEventListener","dispatchEvent","localStorage","sessionStorage","indexedDB","Geolocation","await","async","WebSocket","Worker","postMessage","importScripts","URL","console","debugger"],Et=300,bt={equals:/(\b=\b)/g,quotes:new RegExp(`((&#39;.*?&#39;)|(&#34;.*?&#34;)|(".*?(?<!\\\\)")|('.*?(?<!\\\\)')|\`)`,"g"),comments:/((\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*))/g,logic:/(%=|%|\-|\+|\*|&amp;{1,2}|\|{1,2}|&lt;=|&gt;=|&lt;|&gt;|!={1,2}|={2,3})/g,fn:new RegExp("(?<=^|\\s*)(abs|acos|asin|atan|atan2|ceil|cos|floor|log|max|min|pow|random|round|sin|sqrt|tan|noise|async|await|window|fetch|console|alert|Math|Object|Array|String|class(?!\\s*\\=)|function)(?=\\b)","g"),number:/(\d+(\.\d+)?(e\d+)?)/g,declaration:new RegExp("(?<=^|\\s*)(var|let|const)","g"),parenthesis:/(\(|\))/g,squared:/(\[|\])/g,curly:/(\{|\})/g},u=document.querySelector(".editor__textarea"),Z=document.querySelector(".editor__error"),$t=document.querySelector(".editor__pre"),vt=[{x:0,y:0}];class Rt{constructor(){o(this,"timeout",0);o(this,"validate",async()=>{clearTimeout(this.timeout);const t=u.value.trim();if(this.highlightCode(),t===""){this.showError("Type some code to get started.");return}for(const a of St)if(t.includes(a)){this.showError(`Let's play nice, no usage of "${a}" allowed.`);return}const e=await Y(vt,0,t);if(e.error){this.showError(e.error);return}this.hideError(),r.updateCode(t)});u.addEventListener("input",this.validate),u.addEventListener("change",this.validate),this.updateFromURL(),u.addEventListener("keydown",t=>{t.key=="Enter"&&t.preventDefault()}),r.onChange("code",t=>this.updateValue(t))}updateValue(t){u.value=t,this.highlightCode()}update(t){u.value=t,this.validate()}updateFromURL(){const e=new URLSearchParams(window.location.search).get("code")||"",a=mt(e)||G.code;a.length>Et?this.update("Code in the URL is too long."):this.update(a)}highlightCode(){let t=u.value;for(const[e,a]of Object.entries(bt))t=t.replace(a,`<i class="${e}">$1</i>`);$t.innerHTML=t}showError(t){r.error=t,Z.innerHTML=t}hideError(){r.error="",Z.innerHTML=""}}class z{constructor(t,e,a){o(this,"$inputs");o(this,"name");o(this,"options");o(this,"initialValue");this.name=t,this.options=e,this.initialValue=a,this.$inputs=[...document.querySelectorAll(`input[name=${t}]`)],this.$inputs.forEach(s=>{s.addEventListener("change",()=>{r.updateRadio(this.name,s.value)})}),this.updateFromURL()}updateFromURL(){let e=new URLSearchParams(window.location.search).get(this.name)||this.initialValue;this.options.includes(e)||(e=this.options[0]),r.updateRadio(this.name,e)}update(t){r.updateRadio(this.name,t)}}const M=document.querySelector(".tutorial"),J=document.querySelector(".intro-text");let p=null;const l=[{text:"Pulsar allows you to create animations using code.",code:"sin(t) * 0.5 + 0.5",grid:"classic",animate:"scale"},{text:"Write code that returns a value between 0 and 1. Try changing the code below.",code:"0.5 ",grid:"classic",animate:"scale"},{text:'The code is evaluated for each "pixel" individually.',code:"random()",grid:"classic",animate:"scale"},{text:'Parameter "t" is time in fifth of a second.',code:"cos(t) * 0.5 + 0.5",grid:"classic",animate:"scale"},{text:'You can speed up or slow down the animation by multiplying the "t". To make it loop use the "%" operator.',code:"(t * 0.1) % 1",grid:"classic",animate:"scale"},{text:'Parameters "x" and "y" are coordinates and they span roughly from -6 to 6.',code:"abs(x / 12) + abs(y / 12)",grid:"classic",animate:"scale"},{text:'Parameter "i" is the index of the pixel in the grid.',code:"i % 2"},{text:'You can use any of the mathematical functions available in JavaScript like "cos" or "sqrt".',code:"cos(x) + sin(y)",grid:"classic",animate:"scale"},{text:"Simplex noise is also available.",code:"noise(x + t, y + t)",grid:"classic",animate:"scale"},{text:"You can switch between different grid types and animation properties.",code:"cos(x + t) * 0.5 + 0.5",grid:"hex",animate:"both"},{text:"Here are a few examples to get you started. Radial wave:",code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"classic",animate:"scale"},{text:"Liner cosine wave:",code:"cos(x * 0.8 + t) > y * 0.25 ? 1 : 0",grid:"classic",animate:"scale"},{text:'"Floral" pattern:',code:"(cos(sin(x * y) + t * 0.66) + 1) / 2",grid:"classic",animate:"scale"},{text:"Experiment combining different functions and parameters to create funky animations. Have fun!",code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1",grid:"classic",animate:"scale"},{text:J.innerText,code:""}];class Pt{constructor(t){l[l.length-1].code=r.code,l[l.length-1].grid=r.grid,l[l.length-1].animate=r.animate,M.addEventListener("click",()=>{p===null?p=0:p=(p+1)%l.length,p===l.length-2?M.innerHTML="Finish":p===l.length-1?M.innerHTML="Restart":M.innerHTML="Next";const e=l[p];J.innerHTML=e.text,r.updateCode(e.code),(e.grid||e.animate)&&(e.grid&&r.updateRadio("grid",e.grid),e.animate&&r.updateRadio("animate",e.animate)),t.isPlaying||t.play()})}}const $=document.querySelector(".share");let T=0;$.addEventListener("click",async()=>{try{navigator.share?await navigator.share({title:"Check my Pulsar animation",url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),clearTimeout(T),$.classList.add("share--success"),T=setTimeout(()=>{$.classList.remove("share--success")},3e3))}catch(i){if(i.name==="AbortError")return;clearTimeout(T),$.classList.add("share--error"),T=setTimeout(()=>{$.classList.remove("share--error")},3e3)}});new z("grid",["classic","hex","triangular"],G.grid||"");new z("animate",["scale","opacity","both"],G.animate||"");new Rt;const At=new Lt;new Pt(At);
