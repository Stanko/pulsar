var H=Object.defineProperty;var Z=(s,t,e)=>t in s?H(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var n=(s,t,e)=>(Z(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();const _="pulsar:autoplay",v=document.querySelector("input[name=autoplay]");v.checked=localStorage.getItem(_)==="true";v.addEventListener("change",()=>{localStorage.setItem(_,v.checked.toString())});const V=["classic","hex","triangular"],W=["both","scale","opacity"],B=120,q=["(Math.cos(x * t / 5) + Math.sin(y * t / 5)) / 2","(Math.cos(Math.sqrt(x * x + y * y) - t) + 1) / 2","(Math.cos(Math.sin(x * y) + t * 0.66) + 1) / 2","((Math.cos(t + x + Math.cos(t)) + Math.sin(t + y)) + 2) / 4","Math.sqrt(x*x + y*y) > (Math.cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1","Math.cos(x + t) > y * 0.3 + 0.5 ? (Math.cos(x + t) + 1) / 4 + 0.5 : 0","(t % 10) >= 5 ? (t % 5) / 5 : (5 - (t % 5)) / 5"],L={grid:"classic",animate:"scale",code:q[Math.floor(Math.random()*q.length)]},X=[{name:"grid",validate:s=>V.includes(s)?s:L.grid},{name:"animate",validate:s=>W.includes(s)?s:L.animate},{name:"code",validate:s=>{const t=Y(s);return t.length<=B?t:L.code}}];function z(s){return Object.entries(s).map(([t,e])=>(t==="code"&&(e=K(e)),`${t}=${e}`)).join("&")}function K(s){return encodeURIComponent(btoa(s))}function Y(s){try{return atob(decodeURIComponent(s))}catch{return""}}class Q{constructor(t){n(this,"params",{...L});n(this,"handler");n(this,"$inputs");this.handler=t,this.$inputs=[...document.querySelectorAll("input[name=grid], input[name=animate], textarea[name=code]")],this.$inputs.forEach(e=>{e.addEventListener("input",()=>{this.params[e.name]=e.value,this.updateURL(),this.handler(this.params,e.name)})}),this.updateParamsFromURL()}updateInputs(){this.$inputs.forEach(t=>{t.type==="radio"||t.type==="checkbox"?t.checked=t.value===this.params[t.name]:t.value=this.params[t.name],t.dispatchEvent(new Event("change"))})}updateParamsFromURL(){const t=new URLSearchParams(window.location.search);X.forEach(e=>{t.get(e.name)&&Object.keys(this.params).includes(e.name)&&(this.params[e.name]=e.validate(t.get(e.name)||""))}),this.updateInputs()}updateURL(){const t=z(this.params),e=`${window.location.origin}${window.location.pathname}?${t}`;window.history.replaceState(null,"",e)}}const T=new Worker(new URL("/pulsar/assets/worker-9ce69331.js",self.location));let D;T.addEventListener("message",s=>{D(s.data)});async function J(s,t,e){return new Promise(i=>{D=i,T.postMessage({grid:s.map(({x:r,y:o})=>({x:r,y:o})),t,userCode:e})})}const tt=["fetch","import","export","eval","Function","window","self","top","location","document","alert","prompt","confirm","XMLHttpRequest","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","addEventListener","removeEventListener","dispatchEvent","localStorage","sessionStorage","indexedDB","Geolocation","await","async","WebSocket","Worker","postMessage","importScripts","URL"],et={equals:/(\b=\b)/g,quotes:new RegExp(`((&#39;.*?&#39;)|(&#34;.*?&#34;)|(".*?(?<!\\\\)")|('.*?(?<!\\\\)')|\`)`,"g"),comments:/((\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*))/g,logic:/(%=|%|\-|\+|\*|&amp;{1,2}|\|{1,2}|&lt;=|&gt;=|&lt;|&gt;|!={1,2}|={2,3})/g,fn:new RegExp("(?<=^|\\s*)(abs|acos|asin|atan|atan2|ceil|cos|floor|log|max|min|pow|random|round|sqrt|tan|noise|async|await|window|fetch|console|alert|Math|Object|Array|String|class(?!\\s*\\=)|function)(?=\\b)","g"),number:/(\d+(\.\d+)?(e\d+)?)/g,declaration:new RegExp("(?<=^|\\s*)(var|let|const)","g"),parenthesis:/(\(|\))/g,squared:/(\[|\])/g,curly:/(\{|\})/g};class G{constructor(){n(this,"$textarea");n(this,"$pre");n(this,"$error");n(this,"value","");n(this,"error","");n(this,"validate",()=>{const t=this.$textarea.value.trim();this.highlightCode();for(const e of tt)if(t.includes(e)){const i=`Let's play nice, no usage of "${e}" allowed.`;this.error=i;return}this.error="",this.value=t});this.$pre=document.querySelector(".editor__pre"),this.$error=document.querySelector(".editor__error"),this.$textarea=document.querySelector(".editor__textarea"),this.$textarea.addEventListener("input",this.validate),this.$textarea.addEventListener("change",this.validate),this.validate(),this.$textarea.addEventListener("keydown",t=>{t.key=="Enter"&&t.preventDefault()})}highlightCode(){let t=this.$textarea.value;for(const[e,i]of Object.entries(et))t=t.replace(i,`<i class="${e}">$1</i>`);this.$pre.innerHTML=t}showError(t){this.error=t,this.$error.innerHTML=t}hideError(){this.error="",this.$error.innerHTML=""}}new G;function I(s){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox",`0 0 ${s.width} ${s.height}`),t.setAttribute("width",`${s.width}`),t.setAttribute("height",`${s.height}`),t.style.opacity="0",t}function k(s,t={}){const e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("points",s.map(({x:i,y:r})=>`${i.toFixed(2)},${r.toFixed(2)}`).join(" "));for(const i in t)e.setAttribute(i,t[i]);return e}function st(s,t,e={}){const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",s.x.toFixed(2)),i.setAttribute("cy",s.y.toFixed(2)),i.setAttribute("r",t.toFixed(2));for(const r in e)i.setAttribute(r,e[r]);return i}const b=["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#5856d7","#af52de","#ff2c55"];function F(s,t=1){const e=Math.sqrt(Math.pow(s.x*t,2)+Math.pow(s.y*t,2));return b[Math.floor(e)]||b[b.length-1]}const rt=1.1,$=100,C=$*.85;function it(s,t){const e=[],i=.5*rt,r=2*i/Math.sqrt(3),o=i*2,a=r*1.5,M=Math.PI/3,E=Math.PI/6;for(let d=-t;d<=t;d+=1){const l=d*a,h=d%2!==0,p=h?i:0,R=h?1:0;for(let f=-s-R;f<=s;f+=1){const m=f*o+p,u=[0,1,2,3,4,5].map(A=>{const g=A*M+E;return{x:$*.5+r*C*Math.cos(g),y:$*.5+r*C*Math.sin(g)}}),c=I({width:$,height:$}),S=k(u,{fill:F({x:m,y:l})});c.classList.add("hex"),c.appendChild(S),c.style.left=`${(m*100).toFixed(2)}%`,c.style.top=`${(-l*100).toFixed(2)}%`,e.push({x:m,y:l,$element:c})}}return e}const P=.8,w=100;function ot(s,t){const e=[],r=1*Math.sqrt(3)/2,o=r/3*2*w,a=1/2,M=r,E=Math.PI/6,d=E*4;for(let l=-t;l<=t;l+=1){const h=l*M,p=l%2!==0,R=p?a:0,f=p?2:1,m=p?0:1;for(let u=-s-f;u<=s+m;u+=1){const c=u*a+R,S=u%2!==0,A=S?Math.PI:0,g=S?r/3:0,U=[0,1,2].map(j=>{const O=j*d+E+A;return{x:.5*w+o*P*Math.cos(O),y:.5*w+o*P*Math.sin(O)}}),y=I({width:w,height:w}),N=k(U,{fill:F({x:c,y:h+g},1/P)});y.classList.add("triangle"),y.appendChild(N),y.style.left=`${(c*100).toFixed(2)}%`,y.style.top=`${((h+g)*-100).toFixed(2)}%`,e.push({x:c,y:h,$element:y})}}return e}const nt=.88,at=.5*nt,x=100;function ct(s){const t=[];for(let e=-s;e<=s;e+=1)for(let i=-s;i<=s;i+=1){const r=I({width:x,height:x}),o=st({x:x*.5,y:x*.5},at*x,{fill:F({x:e,y:i})});r.appendChild(o),r.classList.add("circle"),r.style.left=`${(e*100).toFixed(2)}%`,r.style.top=`${(-i*100).toFixed(2)}%`,t.push({x:e,y:i,$element:r})}return t}const lt={classic:()=>ct(6),hex:()=>it(5,6),triangular:()=>ot(8,5)};class dt{constructor(t="classic"){n(this,"$element",document.querySelector(".pixel-wrapper"));n(this,"pixels",[]);this.update(t)}update(t="classic"){this.pixels=lt[t](),this.$element.replaceChildren(...this.pixels.map(e=>e.$element)),this.$element.dataset.variant=t}}const ht=document.querySelector(".pulsar"),ut=document.querySelector(".play-pause"),pt=[...document.querySelectorAll(".toggle-ui")];class ft{constructor(){n(this,"isPlaying",!1);n(this,"raf",0);n(this,"time",0);n(this,"lastRestart",Date.now());n(this,"timeSinceLastRestart",0);n(this,"fps",0);n(this,"fpsStartTime",Date.now());n(this,"grid");n(this,"editor");n(this,"controls");n(this,"animate",async()=>{this.timeSinceLastRestart=this.time+(Date.now()-this.lastRestart)/200,await this.draw()&&this.isPlaying&&(this.raf=requestAnimationFrame(this.animate))});this.editor=new G,this.controls=new Q((t,e)=>{e==="grid"?this.grid.update(t.grid):e==="code"&&this.isPlaying&&this.play(),this.isPlaying||this.draw()}),this.grid=new dt(this.controls.params.grid),this.isPlaying=v.checked,this.isPlaying?this.play():this.draw(),ut.addEventListener("click",()=>{this.isPlaying?this.pause():this.play()}),pt.forEach(t=>{t.addEventListener("click",()=>{document.body.classList.toggle("ui-hidden")})}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.pause()})}updateRootClass(){const t=["pulsar"];this.isPlaying?t.push("is-playing"):t.push("is-paused"),this.editor.error&&t.push("has-error"),ht.setAttribute("class",t.join(" "))}play(){this.isPlaying=!0,this.lastRestart=Date.now(),this.animate(),this.fpsStartTime=Date.now(),this.fps=0,this.updateRootClass()}pauseOnError(){cancelAnimationFrame(this.raf),this.time=this.timeSinceLastRestart,this.fpsStartTime=Date.now(),this.fps=0,this.updateRootClass()}pause(){this.isPlaying=!1,this.time=this.timeSinceLastRestart,cancelAnimationFrame(this.raf),this.updateRootClass()}async draw(){if(this.editor.error)return this.editor.showError(this.editor.error),this.pauseOnError(),!1;const t=await J(this.grid.pixels,this.timeSinceLastRestart,this.controls.params.code);return this.fps++,Date.now()-this.fpsStartTime>1e3&&(console.log("fps",this.fps),this.fpsStartTime=Date.now(),this.fps=0),t.error?(this.editor.showError(t.error),this.pauseOnError(),!1):(this.editor.hideError(),t.data.forEach((e,i)=>{const r=this.grid.pixels[i];if(!r)return;const o=100;let a=(e===0?1e3:(1-1/e)*o).toFixed(2);this.controls.params.animate==="scale"?(r.$element.style.transform=`perspective(${o}px) translateZ(${a}px)`,r.$element.style.opacity=""):this.controls.params.animate==="opacity"?(r.$element.style.opacity=e.toFixed(2),r.$element.style.transform=""):(r.$element.style.transform=`perspective(${o}px) translateZ(${a}px)`,r.$element.style.opacity=e.toFixed(2))}),this.updateRootClass(),!0)}}new ft;
