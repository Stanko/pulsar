var J=Object.defineProperty;var K=(s,t,e)=>t in s?J(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(K(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();let R=localStorage.getItem("pulsar:debug")==="true";window.debug=()=>{localStorage.setItem("pulsar:debug",(!R).toString()),window.location.reload()};R&&document.body.classList.add("debug");function d(...s){R&&console.log(...s)}const Q=["grid","animate","code"];function Y(s){return encodeURIComponent(btoa(s))}function tt(s){try{return atob(decodeURIComponent(s))}catch{return""}}function P(s){const t=new URLSearchParams(window.location.search);Object.entries(s).forEach(([o,n])=>{o==="code"?t.set(o,Y(n)):t.set(o,n)});for(const o of t.keys())Q.includes(o)||t.delete(o);const e=t.toString(),i=`${window.location.origin}${window.location.pathname}?${e}`;d("Updated URL:",JSON.stringify(s)),window.history.replaceState(null,"",i)}const _={code:"sin(t) * 0.5 + 0.5",grid:"classic",animate:"scale"};class et{constructor(){a(this,"code",_.code);a(this,"grid",_.grid);a(this,"animate",_.animate);a(this,"error","");a(this,"handlers",{code:[],grid:[],animate:[]})}onChange(t,e){this.handlers[t].push(e)}updateRadio(t,e){this[t]!==e&&(t==="animate"?(d("Animate changed:",e),this.animate=e):t==="grid"&&(d("Grid changed:",e),this.grid=e),this.handlers[t].forEach(i=>i(e))),P({[t]:e})}updateCode(t){d("Code changed:",t),this.code=t,this.handlers.code.forEach(e=>e(t)),P({code:t})}updateAll(t){this.code=t.code,this.animate=t.animate,this.grid=t.grid,this.handlers.code.forEach(e=>e(this.code)),this.handlers.animate.forEach(e=>e(this.animate)),this.handlers.grid.forEach(e=>e(this.grid)),P(t)}}const r=new et,$=[{code:"(cos(x * t / 5) + sin(y * t / 5)) / 2"},{code:"(cos(sqrt(x * x + y * y) - t) + 1) / 2",grid:"hex"},{code:"(cos(sin(x * y) + t * 0.66) + 1) / 2"},{code:"((cos(t + x + cos(t)) + sin(t + y)) + 2) / 4"},{code:"sqrt(x*x + y*y) > (cos(x + t) + 1) / 2 * 5  ? noise(x + t, y + t) * 0.3 : 1"},{code:"cos(x + t) > y * 0.3 + 0.5 ? (cos(x + t) + 1) / 4 + 0.5 : 0"},{code:"cos(t * 0.5) * 0.5 + 0.5",animate:"opacity"},{code:"sin(0.5 * x + y * t * 0.8) * sin(t / 4)",grid:"triangular"},{code:"sin(x * cos(t * 0.5)) + cos(y * sin(t * 0.5))",grid:"hex"},{code:" sin(t) * sin(x) + cos(t) * cos(y)",grid:"triangular",animate:"opacity"},{code:"abs(abs(x) - abs(y)) < t % 7 ? 1 : 0",grid:"hex"},{code:"sin(3 * atan2(y,x) + t)",grid:"hex"},{code:"1 - (((x + 3) * (x + 4) + y + t * 0.3 * (1 + x * x % 5) * 3) % 36) / 12",animate:"opacity"},{code:"1 / abs((x + y) + (t * 4) % 70 - 35)"}];function X(){return{grid:"classic",animate:"scale",...$[Math.floor(Math.random()*$.length)]}}const st=X(),ot=document.querySelector(".random-example");ot.addEventListener("click",()=>{const s=X();r.updateAll({grid:s.grid||"classic",animate:s.animate||"scale",code:s.code})});const j=new Worker(new URL("/pulsar/assets/worker-b40f7b8b.js",self.location));let T={};j.addEventListener("message",s=>{T[s.data.id](s.data),delete T[s.data.id]});async function W(s,t,e){return new Promise(i=>{const o=Math.random().toString(16)+Date.now().toString(16);T[o]=i,j.postMessage({id:o,grid:s,t,userCode:e})})}const c=window.location.pathname.endsWith("gif.html"),A=c?1:devicePixelRatio,g=c?64:400,it=c?.145:.075,E=g*it,at=c?.8:.88,nt=c?4:6,rt=c?1.5:1,ct=c?E*.8:E*.85,H=1.1,F=c?{w:2,h:3}:{w:5,h:6},dt=c?1.9:1,C=c?1.42:1.33,lt=E*C,N=c?.77:.8,k=c?{w:3,h:2}:{w:8,h:5},ht=c?1.9:1,M=c?["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#af52de","#ff2c60"]:["#ff9500","#ffcc02","#35c759","#5bc7fa","#007aff","#5856d7","#af52de","#ff2c55"];function D(s,t=1){const e=Math.sqrt(Math.pow(s.x*t,2)+Math.pow(s.y*t,2));return M[Math.floor(e)]||M[M.length-1]}function ut(s,t){const e=[],i=.5*H,o=2*i/Math.sqrt(3),n=i*2,h=o*1.5,L=c?-1:0,m=c?h:0;for(let p=-t+L;p<=t+L;p+=1){const y=p*h+m,w=p%2!==0,S=w?i:0,x=w?1:0;for(let u=-s-x;u<=s;u+=1){const v=u*n+S,b=D({x:v,y},1/H*dt);e.push({x:v,y,color:b,r:o*ct})}}return e}function ft(s,t){const e=[],o=1*Math.sqrt(3)/2,n=o/3*2*lt*N,h=1/2,L=o;for(let m=-t;m<=t;m+=1){const p=m*L,y=m%2!==0,w=y?h:0,S=y?2:1,x=y?0:1;for(let u=-s-S;u<=s+x;u+=1){const v=u*h+w,b=u%2!==0,B=b?Math.PI:0,G=b?o/3:0,z=D({x:v,y:p-G},1/N*ht);e.push({x:v*C,y:(p-G)*C,r:n,color:z,angleOffset:B})}}return e}const pt=.5*at;function gt(s){const t=[];for(let e=-s;e<=s;e+=1)for(let i=-s;i<=s;i+=1){const o=D({x:i,y:e},rt);t.push({x:i,y:e,r:pt*E,color:o})}return t}const mt={classic:()=>gt(nt),hex:()=>ut(F.w,F.h),triangular:()=>ft(k.w,k.h)};class yt{constructor(t="classic"){a(this,"type","classic");a(this,"points",[]);this.type=t,this.update(t)}update(t="classic"){this.type=t,this.points=mt[t]()}}const U=document.querySelector(".canvas"),l=U.getContext("2d");U.width=g*A;U.height=g*A;l.scale(A,A);const{PI:wt}=Math,q=Math.PI/6,Z=q*2,Et=Z*2,I=[0,1,2,3,4,5].map(s=>q+s*Z),O=[0,1,2].map(s=>wt+q+s*Et);function Lt(s,t){const{x:e,y:i}=s;l.moveTo(e+t*Math.cos(I[0]),i+t*Math.sin(I[0])),I.forEach(o=>{l.lineTo(e+t*Math.cos(o),i+t*Math.sin(o))})}function Rt(s,t,e){const{x:i,y:o}=s;l.moveTo(i+t*Math.cos(O[0]+e),o+t*Math.sin(O[0]+e)),O.forEach(n=>{l.lineTo(i+t*Math.cos(n+e),o+t*Math.sin(n+e))})}function St(s,t){const{x:e,y:i}=s;l.arc(e,i,t,0,2*Math.PI)}const xt={classic:St,hex:Lt,triangular:Rt};function vt(s,t){l.clearRect(0,0,g,g),c&&(l.globalAlpha=1,l.fillStyle="#000",l.fillRect(0,0,g,g));const e=r.animate==="scale"||r.animate==="both",i=r.animate==="opacity"||r.animate==="both";s.forEach((o,n)=>{const{color:h,x:L,y:m,r:p,angleOffset:y}=o,w=t[n],S=e?w:1,x=i?w:1,u=xt[r.grid];l.globalAlpha=x,l.fillStyle=h,l.beginPath(),u({x:L*E+g*.5,y:g*.5-m*E},p*S,y||0),l.fill()})}const bt=document.querySelector(".pulsar"),At=document.querySelector(".play-pause"),Ct=[...document.querySelectorAll(".toggle-ui")];Ct.forEach(s=>{s.addEventListener("click",()=>{document.body.classList.toggle("ui-hidden")})});const Pt=document.querySelector("input[name=autoplay]"),_t=document.querySelector(".fps"),Mt=document.querySelector(".fps__value");class Gt{constructor(){a(this,"isPlaying",!1);a(this,"wasPlaying",!1);a(this,"raf",0);a(this,"time",0);a(this,"lastRestart",Date.now());a(this,"timeSinceLastRestart",0);a(this,"fps",0);a(this,"fpsHistory",[]);a(this,"fpsStartTime",Date.now());a(this,"grid");a(this,"draw",async()=>{if(cancelAnimationFrame(this.raf),r.error!==""){this.pauseOnError();return}const t=await W(this.grid.points,this.timeSinceLastRestart,r.code);if(R&&(this.fps++,Date.now()-this.fpsStartTime>1e3&&(this.fpsHistory.push(this.fps),this.fpsHistory.length>60&&this.fpsHistory.shift(),_t.innerHTML=this.fpsHistory.map(e=>`<div class="fps__bar" style="height: ${e/2}%"></div>`).join(`
`),Mt.innerHTML=this.fps.toString(),this.fpsStartTime=Date.now(),this.fps=0)),t.error){this.pauseOnError();return}vt(this.grid.points,t.data),this.updateRootClass(),this.isPlaying&&(this.raf=requestAnimationFrame(this.animate))});a(this,"animate",()=>{this.timeSinceLastRestart=this.time+(Date.now()-this.lastRestart)/200,this.draw()});a(this,"playOrDraw",()=>{this.isPlaying?(d("Play or draw - start/resume animation"),this.animate()):(d("Play or draw - draw a single frame"),this.draw())});this.grid=new yt(r.grid),this.isPlaying=Pt.checked,this.playOrDraw(),r.onChange("grid",t=>{this.grid.update(t),this.playOrDraw()}),r.onChange("animate",this.playOrDraw),r.onChange("code",()=>{this.playOrDraw()}),At.addEventListener("click",()=>{this.isPlaying?this.pause():this.play()}),window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?(d("Tab went inactive"),this.wasPlaying=this.isPlaying,this.pause()):document.visibilityState==="visible"&&this.wasPlaying&&(d("Tab is active again - resuming"),this.play())})}updateRootClass(){const t=["pulsar"];this.isPlaying?t.push("is-playing"):t.push("is-paused"),bt.setAttribute("class",t.join(" "))}play(){if(this.isPlaying){d("Play, already playing");return}d("Play"),this.isPlaying=!0,this.lastRestart=Date.now(),this.animate(),R&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pauseOnError(){cancelAnimationFrame(this.raf),this.time=this.timeSinceLastRestart,d("Pause on error"),R&&(this.fpsStartTime=Date.now(),this.fps=0),this.updateRootClass()}pause(){d("Pause"),this.isPlaying=!1,this.time=this.timeSinceLastRestart,cancelAnimationFrame(this.raf),this.updateRootClass()}}const It=["fetch","import","export","eval","Function","window","self","top","location","document","alert","prompt","confirm","XMLHttpRequest","setTimeout","setInterval","clearTimeout","clearInterval","requestAnimationFrame","cancelAnimationFrame","postMessage","addEventListener","removeEventListener","dispatchEvent","localStorage","sessionStorage","indexedDB","Geolocation","await","async","WebSocket","Worker","postMessage","importScripts","URL","console","debugger"],Ot=300,Tt={quotes:new RegExp(`((&#39;.*?&#39;)|(&#34;.*?&#34;)|(".*?(?<!\\\\)")|('.*?(?<!\\\\)')|\`)`,"g"),comments:/((\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(\/\/.*))/g,logic:/(%=|%|\-|\+|\*|&amp;{1,2}|\|{1,2}|&lt;=|&gt;=|&lt;|&gt;|!={1,2}|={2,3})/g,fn:new RegExp("(?<=^|\\s*)(abs|acos|asin|atan|atan2|ceil|cos|floor|log|max|min|pow|random|round|sin|sqrt|tan|noise|async|await|window|fetch|console|alert|Math|Object|Array|String|class(?!\\s*\\=)|function)(?=\\b)","g"),number:/(\d+(\.\d+)?(e\d+)?)/g,declaration:new RegExp("(?<=^|\\s*)(var|let|const)","g"),parenthesis:/(\(|\))/g,squared:/(\[|\])/g,curly:/(\{|\})/g,equals:/(\b\s?=\s?\b)/g},f=document.querySelector(".editor__textarea"),V=document.querySelector(".editor__error"),Dt=document.querySelector(".editor__pre"),Ut=[{x:0,y:0}];class $t{constructor(){a(this,"timeout",0);a(this,"validate",async()=>{clearTimeout(this.timeout);const t=f.value;if(this.highlightCode(),t===""){this.showError("Type some code to get started.");return}for(const i of It)if(t.includes(i)){this.showError(`Let's play nice, no usage of "${i}" allowed.`);return}const e=await W(Ut,0,t);if(e.error){this.showError(e.error);return}d(r.error),this.hideError(),r.updateCode(t)});f.addEventListener("input",this.validate),f.addEventListener("change",this.validate),this.updateFromURL(),f.addEventListener("keydown",t=>{t.key=="Enter"&&t.preventDefault()}),r.onChange("code",t=>this.updateValue(t))}updateValue(t){f.value!==t&&(f.value=t,this.highlightCode(),d("Editor, code updated"),r.error&&this.validate())}update(t){f.value!==t&&(f.value=t,d("Editor, code updated and validated")),this.validate()}updateFromURL(){const e=new URLSearchParams(window.location.search).get("code")||"",i=tt(e)||st.code;i.length>Ot?this.update("Code in the URL is too long."):this.update(i)}highlightCode(){let t=f.value;for(const[e,i]of Object.entries(Tt))t=t.replace(i,`<i class="${e}">$1</i>`);Dt.innerHTML=t}showError(t){d(`Error: %c${t}`,"color: red","code:",f.value),r.error=t,V.innerHTML=t}hideError(){d("Clear error"),r.error="",V.innerHTML=""}}class Ht{constructor(t,e,i){a(this,"$inputs");a(this,"name");a(this,"options");a(this,"initialValue");this.name=t,this.options=e,this.initialValue=i,this.$inputs=[...document.querySelectorAll(`input[name=${t}]`)],this.$inputs.forEach(o=>{o.checked=o.value===i,o.addEventListener("change",()=>{r.updateRadio(this.name,o.value)})}),r.onChange(t,o=>{this.$inputs.forEach(n=>{n.checked=n.value===o})}),this.updateFromURL()}updateFromURL(){let e=new URLSearchParams(window.location.search).get(this.name)||this.initialValue;this.options.includes(e)||(e=this.options[0]),r.updateRadio(this.name,e)}update(t){r.updateRadio(this.name,t)}}export{g as C,$t as E,Gt as P,Ht as R,l as c,A as p,st as r,r as s};
